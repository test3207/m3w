<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Critical inline CSS for instant LCP - shows loading spinner immediately -->
    <style>
      /* CSS variables matching Tailwind theme (gray-900, gray-50, background) */
      :root{--m3w-bg:#ffffff;--m3w-spinner:#111827}
      @media(prefers-color-scheme:dark){:root{--m3w-bg:#0a0a0a;--m3w-spinner:#f9fafb}}
      /* Minimal reset and loading state styles */
      *,*::before,*::after{box-sizing:border-box}
      body{margin:0;font-family:system-ui,-apple-system,sans-serif;background:var(--m3w-bg)}
      #root{min-height:100vh}
      /* Loading spinner - matches PageLoader component (border-gray-900/50) */
      .page-loader{display:flex;align-items:center;justify-content:center;min-height:100vh}
      .page-loader-spinner{width:3rem;height:3rem;border-radius:50%;border:2px solid transparent;border-bottom-color:var(--m3w-spinner);animation:spin 1s linear infinite}
      @keyframes spin{to{transform:rotate(360deg)}}
    </style>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Self-hosted music player with offline support" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <!-- manifest will be auto-injected by vite-plugin-pwa -->
    
    <title>M3W - Music Player</title>
    
    <!-- Runtime configuration injection point (replaced by docker-entrypoint.sh or CF Worker) -->
    <script>
      // API Base URL for backend requests
      // - AIO mode: empty string (relative URLs)
      // - Separated mode: full URL to backend (e.g., 'http://localhost:4000')
      // - Placeholder '__API_BASE_URL__' is replaced at container startup
      window.__API_BASE_URL__ = '__API_BASE_URL__';
      
      // Multi-region configuration (optional, for global deployment)
      // - Local dev / AIO: not set (multi-region disabled)
      // - Multi-region: '__M3W_CONFIG__' placeholder replaced by CF Worker
      // Example config structure:
      // {
      //   multiRegion: true,
      //   mainDomain: 'https://m3w.example.com',
      //   regions: [
      //     { name: 'jp', endpoint: 'https://jp.m3w.example.com' },
      //     { name: 'sea', endpoint: 'https://sea.m3w.example.com' },
      //   ]
      // }
      //
      // CF Worker injection example:
      // ```js
      // async function handleRequest(request) {
      //   const response = await fetch(request);
      //   const html = await response.text();
      //   const config = JSON.stringify({
      //     multiRegion: true,
      //     mainDomain: 'https://m3w.example.com',
      //     regions: [
      //       { name: 'jp', endpoint: 'https://jp.m3w.example.com' },
      //       { name: 'sea', endpoint: 'https://sea.m3w.example.com' },
      //     ]
      //   });
      //   // Note: Replace the entire quoted placeholder string
      //   return new Response(
      //     html.replace("'__M3W_CONFIG__'", config),
      //     { headers: response.headers }
      //   );
      // }
      // ```
      window.__M3W_CONFIG__ = '__M3W_CONFIG__';
    </script>
  </head>
  <body>
    <!-- Initial loading state - replaced by React when app mounts -->
    <div id="root">
      <div class="page-loader">
        <div class="page-loader-spinner"></div>
      </div>
    </div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
