<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Critical inline CSS for instant LCP -->
    <style>
      /* CSS variables matching Tailwind theme */
      :root{--m3w-bg:#ffffff;--m3w-fg:#0a0a0a;--m3w-muted:#6b7280;--m3w-primary:#2563eb}
      @media(prefers-color-scheme:dark){:root{--m3w-bg:#0a0a0a;--m3w-fg:#fafafa;--m3w-muted:#9ca3af;--m3w-primary:#3b82f6}}
      /* Minimal reset */
      *,*::before,*::after{box-sizing:border-box}
      body{margin:0;font-family:system-ui,-apple-system,sans-serif;background:var(--m3w-bg);color:var(--m3w-fg)}
      #root{min-height:100vh}
      /* Pre-rendered home page for instant LCP */
      .prerender-home{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:1rem}
      .prerender-hero{text-align:center;max-width:28rem}
      .prerender-icon{margin-bottom:1.5rem;display:flex;justify-content:center}
      .prerender-icon>svg{padding:1rem;border-radius:50%;background:color-mix(in srgb,var(--m3w-primary) 10%,transparent);color:var(--m3w-primary)}
      .prerender-title{font-size:1.875rem;font-weight:700;margin:0 0 0.75rem;letter-spacing:-0.025em}
      .prerender-desc{color:var(--m3w-muted);margin:0;line-height:1.5}
      /* Fallback spinner for non-home routes */
      .page-loader{display:flex;align-items:center;justify-content:center;min-height:100vh}
      .page-loader-spinner{width:3rem;height:3rem;border-radius:50%;border:2px solid transparent;border-bottom-color:var(--m3w-fg);animation:spin 1s linear infinite}
      @keyframes spin{to{transform:rotate(360deg)}}
    </style>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Self-hosted music player with offline support" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <!-- manifest will be auto-injected by vite-plugin-pwa -->
    
    <title>M3W - Music Player</title>
    
    <!-- Runtime configuration injection point (replaced by docker-entrypoint.sh or CF Worker) -->
    <script>
      // API Base URL for backend requests
      // - AIO mode: empty string (relative URLs)
      // - Separated mode: full URL to backend (e.g., 'http://localhost:4000')
      // - Placeholder '__API_BASE_URL__' is replaced at container startup
      window.__API_BASE_URL__ = '__API_BASE_URL__';
      
      // Multi-region configuration (optional, for global deployment)
      // - Local dev / AIO: not set (multi-region disabled)
      // - Multi-region: '__M3W_CONFIG__' placeholder replaced by CF Worker
      // Example config structure:
      // {
      //   multiRegion: true,
      //   mainDomain: 'https://m3w.example.com',
      //   regions: [
      //     { name: 'jp', endpoint: 'https://jp.m3w.example.com' },
      //     { name: 'sea', endpoint: 'https://sea.m3w.example.com' },
      //   ]
      // }
      //
      // CF Worker injection example:
      // ```js
      // async function handleRequest(request) {
      //   const response = await fetch(request);
      //   const html = await response.text();
      //   const config = JSON.stringify({
      //     multiRegion: true,
      //     mainDomain: 'https://m3w.example.com',
      //     regions: [
      //       { name: 'jp', endpoint: 'https://jp.m3w.example.com' },
      //       { name: 'sea', endpoint: 'https://sea.m3w.example.com' },
      //     ]
      //   });
      //   // Note: Replace the entire quoted placeholder string
      //   return new Response(
      //     html.replace("'__M3W_CONFIG__'", config),
      //     { headers: response.headers }
      //   );
      // }
      // ```
      window.__M3W_CONFIG__ = '__M3W_CONFIG__';
    </script>
  </head>
  <body>
    <!-- Pre-rendered landing page for instant LCP -->
    <!-- React replaces this content on mount, i18n updates text dynamically -->
    <div id="root">
      <div class="prerender-home">
        <!-- Hero content (LCP target) -->
        <div class="prerender-hero">
          <div class="prerender-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
          </div>
          <h1 class="prerender-title">M3W</h1>
          <p class="prerender-desc">Self-hosted music player with offline support and complete library ownership.</p>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
